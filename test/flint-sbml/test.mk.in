SQLITE3 = sqlite3 -batch -noheader -separator ' '

.PHONY: all clean check check-name

all: OUTPUT/run

check: check-name OUTPUT/value.diff OUTPUT/function.diff OUTPUT/ode.diff

clean:
	-rm -rf OUTPUT

OUTPUT:
	mkdir -p $@

OUTPUT/db: INPUT | OUTPUT
	test-input1 $@ $<

OUTPUT/run: OUTPUT/db
	flint-sbml $< OUTPUT/value OUTPUT/function OUTPUT/ode > $@

OUTPUT/value OUTPUT/function OUTPUT/ode: OUTPUT/run

check-name: OUTPUT/db EXPECTED/name.o.txt
	($(SQLITE3) $< 'SELECT space_id, type, id, name FROM names' | diff -u EXPECTED/name.o.txt -)

OUTPUT/value.diff: EXPECTED/value.o.txt OUTPUT/value
	diff -u $^ > $@

OUTPUT/function.diff: EXPECTED/function.o.txt OUTPUT/function
	diff -u $^ > $@

OUTPUT/ode.diff: EXPECTED/ode.o.txt OUTPUT/ode
	diff -u $^ > $@
